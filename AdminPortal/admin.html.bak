<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .member-list { border-collapse: collapse; width: 100%; }
    .member-list th, .member-list td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .member-list th { background-color: #f2f2f2; }
    .member-editor { margin-top: 20px; }
    .hidden { display: none; }
    input[type="text"], select { padding: 6px; width: 200px; margin-right: 10px; }
    button { padding: 6px 12px; }
  </style>
</head>
<body>
  <h2>Admin Portal</h2>
  <div>
    <input type="text" id="search" placeholder="Search by name or email" />
    <select id="filter">
      <option value="">All Statuses</option>
      <option value="NEW">New</option>
      <option value="REGISTERED">Registered</option>
      <option value="VERIFIED">Verified</option>
      <option value="APPLIED">Applied</option>
      <option value="PENDING">Pending</option>
    </select>
    <button onclick="loadMembers()">Search</button>
  </div>
  <div id="memberListContainer">
    <table class="member-list" id="memberList">
      <thead>
        <tr>
          <th>Email</th>
          <th>Name</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="memberRows"></tbody>
    </table>
  </div>

  <div id="memberEditor" class="member-editor hidden">
    <h3>Edit Member</h3>
    <label>Email: <input type="text" id="editEmail" disabled /></label><br>
    <label>First Name: <input type="text" id="editFirstName" /></label><br>
    <label>Last Name: <input type="text" id="editLastName" /></label><br>
    <button onclick="saveMember()">Save Changes</button>
  </div>

  <script>
    let selectedMember = null;
   
    function loadMembers() {
      const search = document.getElementById('search').value.toLowerCase();
      const filter = document.getElementById('filter').value;

      google.script.run.withSuccessHandler(members => {
      const filtered = members.filter(m => {
          const matchesSearch = !search || m.emailAddress?.toLowerCase().includes(search) ||
                                m.firstName?.toLowerCase().includes(search) ||
                                m.lastName?.toLowerCase().includes(search);
        const matchesFilter = !filter || m.registration.status === filter;
        return matchesSearch && matchesFilter;
      });

        const tbody = document.getElementById('memberRows');
      tbody.innerHTML = '';
      filtered.forEach(member => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${member.emailAddress || ''}</td>
            <td>${member.firstName || ''} ${member.lastName || ''}</td>
            <td>${member.memberStatus || ''}</td>
          <td><button onclick="editMember('${member.emailAddress}')">Edit</button></td>
        `;
        tbody.appendChild(row);
      });
    }).getAllMembers();
    }

    function editMember(email) {
      google.script.run.withSuccessHandler(member => {
        selectedMember = member;
        document.getElementById('editEmail').value = member.emailAddress;
        document.getElementById('editFirstName').value = member.firstName;
        document.getElementById('editLastName').value = member.lastName;
        document.getElementById('memberEditor').classList.remove('hidden');
      }).getMemberByEmail(email);
    }

    function saveMember() {
      const updatedMember = {
        emailAddress: selectedMember.emailAddress,
        firstName: document.getElementById('editFirstName').value,
        lastName: document.getElementById('editLastName').value
      };
      google.script.run
        .withSuccessHandler(() => {
          document.getElementById('memberEditor').classList.add('hidden');
          loadMembers();
        })
        .updateMemberInfo(updatedMember);
    }

    // Initial load of members
    loadMembers();
  </script>
  <p><h5>Version: SNAPSHOT-0.00.007</h5></p>
</body>
</html>
</html>

